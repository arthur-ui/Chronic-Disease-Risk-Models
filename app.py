import joblibimport pandas as pdimport streamlit as st# Load the full pipeline (preprocessing + model)pipe = joblib.load("diabetes_model.joblib")st.set_page_config(page_title="Diabetes Risk Tool", page_icon="??")st.title("Non-Dietary Diabetes Risk Assessment")st.caption("Research prototype based on NHANES 2011Ð2020. Not for clinical use.")# ---- User inputs ----col1, col2 = st.columns(2)with col1:    age = st.number_input("Age (years)", min_value=18, max_value=90, value=45)    bmi = st.number_input("BMI (kg/m?)", min_value=15.0, max_value=60.0, value=27.0)    waist = st.number_input("Waist circumference (cm)", min_value=50.0, max_value=200.0, value=95.0)    sbp = st.number_input("Average systolic BP (mmHg)", min_value=80, max_value=220, value=120)with col2:    dbp = st.number_input("Average diastolic BP (mmHg)", min_value=40, max_value=140, value=75)    hr = st.number_input("Average resting heart rate (bpm)", min_value=40, max_value=140, value=70)    smoker = st.selectbox("Current smoker?", ["No", "Yes"])    activity = st.selectbox("Physical activity level", ["Low", "Moderate", "High"])income = st.number_input("Family income-to-poverty ratio", min_value=0.0, max_value=10.0, value=2.0)col3, col4 = st.columns(2)with col3:    gender = st.selectbox("Gender", ["Male", "Female"])with col4:    race = st.selectbox(        "Race/ethnicity",        ["Non-Hispanic White", "Non-Hispanic Black", "Hispanic", "Other"]    )# Map UI values to the same coding used in your CSVgender_map = {"Male": 1, "Female": 2}  # <-- adjust to real codesrace_map = {    "Non-Hispanic White": 1,    "Non-Hispanic Black": 2,    "Hispanic": 3,    "Other": 4,}smoke_map = {"No": 0, "Yes": 1}activity_map = {"Low": 1, "Moderate": 2, "High": 3}if st.button("Estimate diabetes risk"):    X_raw = pd.DataFrame([{        "bmi": bmi,        "AgeYears": age,        "waist_circumference": waist,        "activity_level": activity_map[activity],        "smoking": smoke_map[smoker],        "avg_systolic": sbp,        "avg_diastolic": dbp,        "avg_HR": hr,        "FamIncome_to_poverty_ratio": income,        "Education": None,                 # you can add a widget later        "Race": race_map[race],        "Gender": gender_map[gender],    }])    proba = float(pipe.predict_proba(X_raw)[0, 1])    st.metric("Estimated current diabetes risk", f"{proba*100:.1f}%")    st.caption(        "This estimate is based on non-dietary predictors only and is intended "        "for research and educational purposes, not for diagnosis or treatment."    )st.markdown("---")st.markdown("**Model details**")st.markdown(    "- Model: Bagged decision trees with preprocessing pipeline\n"    "- Training data: NHANES 2011Ð2016, validated on 2017Ð2020\n"    "- Inputs: anthropometrics, vital signs, and sociodemographic variables")